<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-14"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><a name="line-16"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">-- | This module provides a way to name the fields in a regular</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- Haskell tuple and then look them up later, statically.</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Labels</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">TypeLits</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">OverloadedLabels</span><span>
</span><a name="line-33"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- A labelled value</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-comment">-- | Field named @l@ labels value of type @t@.</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- Example: @(#name := \&quot;Chris\&quot;) :: (\&quot;name\&quot; := String)@</span><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="local-1627414615"><a href="#local-1627414615"><span class="hs-identifier">label</span></a></a><span> </span><a name="%3A%3D"><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator">:=</span></a></a><span> </span><a name="local-1627414616"><a href="#local-1627414616"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-1627414615"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627414615"><span class="hs-identifier hs-type">label</span></a><span> </span><a name="%3A%3D"><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator">:=</span></a></a><span> </span><a href="#local-1627414616"><span class="hs-identifier hs-type">value</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><span class="hs-special">(</span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><span class="hs-special">(</span><a href="#local-1627424209"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424210"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">infix</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-operator">:=</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-1627424205"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="#local-1627424206"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424205"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-identifier">_</span><span> </span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a><span> </span><a name="local-1627424207"><a href="#local-1627424207"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-805306535"><span class="hs-operator">==</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a><span> </span><a name="local-1627424208"><a href="#local-1627424208"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627424207"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627424208"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-pragma">{-# INLINE (==) #-}</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627424201"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><span class="hs-special">(</span><a href="#local-1627424202"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424201"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-50"></a><span>  </span><a name="local-1912609166"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a><span> </span><a name="local-1627424203"><a href="#local-1627424203"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a><span> </span><a name="local-1627424204"><a href="#local-1627424204"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627424203"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1627424204"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-pragma">{-# INLINE compare #-}</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-1627424197"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="#local-1627424198"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424197"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-54"></a><span>  </span><a name="local-1912609031"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a name="local-1627424199"><a href="#local-1627424199"><span class="hs-identifier">l</span></a></a><span> </span><a href="Labels.Internal.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a><span> </span><a name="local-1627424200"><a href="#local-1627424200"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">symbolVal</span><span> </span><a href="#local-1627424199"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; := &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-1627424200"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- Basic accessors</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">class</span><span> </span><a name="Has"><a href="Labels.Internal.html#Has"><span class="hs-identifier">Has</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627414453"><a href="#local-1627414453"><span class="hs-identifier">label</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><a name="local-1627414454"><a href="#local-1627414454"><span class="hs-identifier">value</span></a></a><span> </span><a name="local-1627414455"><a href="#local-1627414455"><span class="hs-identifier">record</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">label</span><span> </span><span class="hs-identifier">record</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-comment">-- | Get a field by doing: @get #salary employee@</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-identifier">get</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627414453"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414455"><span class="hs-identifier hs-type">record</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414454"><span class="hs-identifier hs-type">value</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-comment">-- | Set a field by doing: @set #salary 54.00 employee@</span><span>
</span><a name="line-63"></a><span>  </span><span class="hs-identifier">set</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627414453"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414454"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414455"><span class="hs-identifier hs-type">record</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414455"><span class="hs-identifier hs-type">record</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | Modify a field by doing: @modify #salary (* 1.1) employee@</span><span>
</span><a name="line-66"></a><span class="hs-identifier">modify</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Labels.Internal.html#Has"><span class="hs-identifier hs-type">Has</span></a><span> </span><a href="#local-1627414617"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627414618"><span class="hs-identifier hs-type">value</span></a><span> </span><a href="#local-1627414619"><span class="hs-identifier hs-type">record</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627414617"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627414618"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414618"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414619"><span class="hs-identifier hs-type">record</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414619"><span class="hs-identifier hs-type">record</span></a><span>
</span><a name="line-67"></a><a name="modify"><a href="Labels.Internal.html#modify"><span class="hs-identifier">modify</span></a></a><span> </span><a name="local-1627414620"><a href="#local-1627414620"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627414621"><a href="#local-1627414621"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627414622"><a href="#local-1627414622"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Labels.Internal.html#set"><span class="hs-identifier hs-var">set</span></a><span> </span><a href="#local-1627414620"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627414621"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="Labels.Internal.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-1627414620"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627414622"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627414622"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-68"></a><span class="hs-pragma">{-# INLINE modify #-}</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- Cons two records together</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">class</span><span> </span><a name="Cons"><a href="Labels.Internal.html#Cons"><span class="hs-identifier">Cons</span></a></a><span> </span><a name="local-1627414013"><a href="#local-1627414013"><span class="hs-identifier">label</span></a></a><span> </span><a name="local-1627414014"><a href="#local-1627414014"><span class="hs-identifier">value</span></a></a><span> </span><a name="local-1627414015"><a href="#local-1627414015"><span class="hs-identifier">record</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Consed</span><span> </span><a name="local-1627414013"><a href="#local-1627414013"><span class="hs-identifier">label</span></a></a><span> </span><a name="local-1627414014"><a href="#local-1627414014"><span class="hs-identifier">value</span></a></a><span> </span><a name="local-1627414015"><a href="#local-1627414015"><span class="hs-identifier">record</span></a></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- | Cons a field onto a record by doing: @cons (#foo := 123) record@</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-identifier">cons</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627414013"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627414014"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627414015"><span class="hs-identifier hs-type">record</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Labels.Internal.html#Consed"><span class="hs-identifier hs-type">Consed</span></a><span> </span><a href="#local-1627414013"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627414014"><span class="hs-identifier hs-type">value</span></a><span> </span><a href="#local-1627414015"><span class="hs-identifier hs-type">record</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">instance</span><span> </span><a href="Labels.Internal.html#Cons"><span class="hs-identifier hs-type">Cons</span></a><span> </span><a href="#local-1627424194"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627424195"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Consed</span><span> </span><a href="#local-1627424194"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627424195"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627424194"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424195"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>  </span><a name="local-1912622528"><a href="Labels.Internal.html#cons"><span class="hs-identifier">cons</span></a></a><span> </span><a name="local-1627424196"><a href="#local-1627424196"><span class="hs-identifier">field</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627424196"><span class="hs-identifier hs-var">field</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-pragma">{-# INLINE cons #-}</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">instance</span><span> </span><a href="Labels.Internal.html#Cons"><span class="hs-identifier hs-type">Cons</span></a><span> </span><a href="#local-1627424188"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627424189"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627424190"><span class="hs-identifier hs-type">label'</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424191"><span class="hs-identifier hs-type">value'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Consed</span><span> </span><a href="#local-1627424188"><span class="hs-identifier hs-type">label</span></a><span> </span><a href="#local-1627424189"><span class="hs-identifier hs-type">value</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627424190"><span class="hs-identifier hs-type">label'</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424191"><span class="hs-identifier hs-type">value'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627424188"><span class="hs-identifier hs-type">label</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424189"><span class="hs-identifier hs-type">value</span></a><span class="hs-special">,</span><a href="#local-1627424190"><span class="hs-identifier hs-type">label'</span></a><span> </span><span class="hs-operator">:=</span><span> </span><a href="#local-1627424191"><span class="hs-identifier hs-type">value'</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>  </span><a name="local-1912622528"><a href="Labels.Internal.html#cons"><span class="hs-identifier">cons</span></a></a><span> </span><a name="local-1627424192"><a href="#local-1627424192"><span class="hs-identifier">field</span></a></a><span> </span><a name="local-1627424193"><a href="#local-1627424193"><span class="hs-identifier">field2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627424192"><span class="hs-identifier hs-var">field</span></a><span class="hs-special">,</span><a href="#local-1627424193"><span class="hs-identifier hs-var">field2</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-pragma">{-# INLINE cons #-}</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- Labels</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800</span><span>
</span><a name="line-92"></a><span class="hs-keyword">instance</span><span> </span><a href="#local-1627423923"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-1627423924"><span class="hs-identifier hs-type">l'</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-93"></a><span>         </span><span class="hs-identifier hs-type">IsLabel</span><span> </span><span class="hs-special">(</span><a href="#local-1627423923"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627423924"><span class="hs-identifier hs-type">l'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-94"></a><span>    </span><a name="local-1912605531"><span class="hs-identifier">fromLabel</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-pragma">{-# INLINE fromLabel #-}</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">instance</span><span> </span><a href="Labels.Internal.html#Has"><span class="hs-identifier hs-type">Has</span></a><span> </span><a href="#local-1627423920"><span class="hs-identifier hs-type">l</span></a><span> </span><a href="#local-1627423921"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627423922"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-98"></a><span>         </span><span class="hs-identifier hs-type">IsLabel</span><span> </span><span class="hs-special">(</span><a href="#local-1627423920"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627423922"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627423921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-1912605531"><span class="hs-identifier">fromLabel</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Labels.Internal.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627423920"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-pragma">{-# INLINE fromLabel #-}</span><span>
</span><a name="line-101"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">IsString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>  </span><a name="local-805306554"><span class="hs-identifier">fromString</span></a><span> </span><a name="local-1627423298"><a href="#local-1627423298"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">litT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StrTyLit</span><span> </span><a href="#local-1627423298"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- TH-derived instances</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">makeInstance</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-special">[</span><a href="#local-1627437539"><span class="hs-identifier hs-var">d</span></a><span class="hs-glyph">|</span><span class="hs-keyword">instance</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">Cons</span></a><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span></a><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varT</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">label_tyvar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span></a><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varT</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">value_tyvar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tupTy</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>             </span><span class="hs-keyword">type</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">Consed</span></a><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span></a><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varT</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">label_tyvar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span></a><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varT</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">value_tyvar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tupTy</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">newTupTy</span></a><span>
</span><a name="line-112"></a><span>             </span><a href="#local-1627437539"><span class="hs-identifier hs-var">cons</span></a><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span></a><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varP</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">field_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tupPat</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tupEx</span></a><span>
</span><a name="line-113"></a><span>             </span><span class="hs-pragma">{-# INLINE cons #-}</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-114"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">label_tyvar</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">mkName</span></a><span> </span><span class="hs-string">&quot;label&quot;</span><span>
</span><a name="line-115"></a><span>              </span><a href="#local-1627437539"><span class="hs-identifier hs-var">value_tyvar</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">mkName</span></a><span> </span><span class="hs-string">&quot;value&quot;</span><span>
</span><a name="line-116"></a><span>              </span><a href="#local-1627437539"><span class="hs-identifier hs-var">field_name</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">mkName</span></a><span> </span><span class="hs-string">&quot;field&quot;</span><span>
</span><a name="line-117"></a><span>              </span><a href="#local-1627437539"><span class="hs-identifier hs-var">tupPat</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">tupP</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a href="#local-1627437539"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">varP</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">mkName</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;v&quot;</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-1627437539"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>              </span><a href="#local-1627437539"><span class="hs-identifier hs-var">tupEx</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">tupE</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">varE</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">field_name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a href="#local-1627437539"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">varE</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">mkName</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;v&quot;</span><span> </span><a href="#local-1627437539"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627437539"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-1627437539"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>              </span><a href="#local-1627437539"><span class="hs-identifier hs-var">newTupTy</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-120"></a><span>                  </span><a href="#local-1627437539"><span class="hs-identifier hs-var">foldl</span></a><span>
</span><a name="line-121"></a><span>                      </span><a href="#local-1627437539"><span class="hs-identifier hs-var">appT</span></a><span>
</span><a name="line-122"></a><span>                      </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">tupleT</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">size</span><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>                      </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">appT</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">appT</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627437539"><span class="hs-identifier hs-var">conT</span></a><span> </span><span class="hs-char">''(:=)) (varT label_tyvar)) (varT value_tyvar)) :
                       (map
                            (\j -&gt;
                                  varT (mkName (&quot;u&quot; ++ show j)))
                            [1 .. size]))
              tupTy =
                foldl
                    appT
                    (tupleT size)
                    (map
                         (\j -&gt;
                               varT (mkName (&quot;u&quot; ++ show j)))
                         [1 .. size])
  in fmap concat (mapM makeInstance [2 .. 24]))

$(let makeInstance size slot =
          [d|instance Has $(varT l_tyvar) $(varT a_tyvar) $instHead
               where get _ = $getImpl
                     {-# INLINE get #-}
                     set _ = $setImpl
                     {-# INLINE set #-}
                     |]
        where
          l_tyvar = mkName &quot;l&quot;
          a_tyvar = mkName &quot;a&quot;
          getImpl =
              lamE
                  [ tupP (map (\j -&gt; if j == slot then infixP wildP '(:=) (varP a_var) else wildP)
                              [1 .. size])]
                  (varE a_var)
            where a_var = mkName &quot;a&quot;
          setImpl =
            lamE
                [ varP v_var
                ,tupP
                     (map
                          (\j -&gt;
                                if j == slot
                                   then infixP
                                            (varP (nth_proxy_var j))
                                            '(:=)
                                            wildP
                                   else varP (nth_var j))
                          [1 .. size])]
                (tupE
                      (map
                           (\j -&gt;
                                 if j == slot
                                    then appE
                                             (appE (conE '(:=)) (varE (nth_proxy_var j)))
                                             (if j == slot
                                                  then varE v_var
                                                  else varE (nth_var j))
                                    else varE (nth_var j))
                           [1 .. size]))
            where nth_var i = mkName (&quot;u_&quot; ++ show i)
                  nth_proxy_var i = mkName (&quot;p_&quot; ++ show i)
                  v_var = mkName &quot;v&quot;
          instHead =
              foldl
                  appT
                  (tupleT size)
                  (map
                       (\j -&gt;
                             if j == slot
                                 then appT (appT (conT ''(:=)) (varT l_tyvar)) (varT a_tyvar)
                                 else varT (mkName (&quot;u&quot; ++ show j)))
                       [1 .. size])
  in fmap
         (concat . concat)
         (mapM (\size -&gt; mapM (\slot -&gt; makeInstance size slot)
                              [1 .. size])
                [1 .. 24]))

</span></pre></body></html>